<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Retreat</title>
    <script
  src="http://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>
<body>
  <style>
    #status {
      width: 300px;
      height: 50px;
      color: crimson;
      font-size: 30px;
    }
  </style>
  <div id="status"></div>


  <div>
  <button id="book">Book</button><input type="email" id="email"  />
  </div>
  <hr/>
  <div>ADMIN AREA</div>
  <div>
      <form id="testForm">
          <input type="radio" name="test" value="CLOSED"/>Approve
          <input type="radio" name="test" value="OPEN"/>Cancel
          <input id="submitBtn" type="submit" value="OK">
      </form>  
  </div>
  <hr/>
  <div style="float:left">current status:</div><div id="currentStatus"></div>



<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDSS74nZRS-aYHG6CSc16uw3H1pKMxjqwk",
    authDomain: "retreat-email-flow.firebaseapp.com",
    databaseURL: "https://retreat-email-flow.firebaseio.com",
    projectId: "retreat-email-flow",
    storageBucket: "retreat-email-flow.appspot.com",
    messagingSenderId: "696309126247"
  };
  firebase.initializeApp(config);

  var db = firebase.database();

  db.ref('Appointments').on('value', (snapshot) => {
    // var msg = "Not Available";
    var status = $("#status");
    var btn = $("#submitBtn");
    $("#currentStatus").html(snapshot.val());

    if(snapshot.val() === "PENDING" || snapshot.val() === "CLOSED") {
      status.html(msg)
      //btn.hide()
      return false;
    }
    status.html("AVAILABLE");
    btn.show()
  });

  $("#testForm").submit((e)=>{
      e.preventDefault();
      var selectedVal = $("input[name='test']:checked").val();
      alert(selectedVal);
      updateValue(selectedVal);
  })
  
  $("#book").click(() => {

    var currentStatus =  $("#currentStatus").text();
    var email = $("#email").val();

    if(email  === ""){
      alert('please insert email address')
      return false;
    }
    if( currentStatus == "PENDING" ||  currentStatus =="CLOSED" || currentStatus == "") {
      alert('NOT AVAILABLE');
      return false;
    }
    db.ref("test").update({ appointment: "PENDING", email:email });
    alert('BOOKED')
  })
  function updateValue(selectedVal) {
    db.ref("test").update({ appointment: selectedVal });
  }
 
</script>
</body>
</html>
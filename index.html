<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script
  src="http://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>
<body>
  <style>
    #status {
      width: 300px;
      height: 50px;
      color: crimson;
      font-size: 30px;
    }
  </style>
  <div id="status"></div>


  <div>
  <button id="book">BOOK</button>   <input type="email" id="email"  />
  </div>
  <hr/>
  <div>ADMIN AREA</div>
  <div>
      <form id="testForm">
          <input type="radio" name="test" value="CLOSED"/>APPROVE
          <input type="radio" name="test" value="OPEN"/>CANCEL
          <input id="submitBtn" type="submit" value="OK">
      </form>  
  </div>
  <hr/>
  <div style="float:left">current status:</div><div id="currentStatus"></div>



<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  // TODO: Replace with your project's customized code snippet
  var config = {
    apiKey: "AIzaSyAF83A71cpCFOnU8MBYPzqREe3za_2pxPI",
    authDomain: "test-a1655.firebaseapp.com",
    databaseURL:"https://test-a1655.firebaseio.com"
  };
  firebase.initializeApp(config);
  var db = firebase.database();

  db.ref('test/appointment').on('value', (snapshot) => {
    var msg = "NOT AVAILABLE";
    var status = $("#status");
    var btn = $("#submitBtn");
    $("#currentStatus").html(snapshot.val());

    if(snapshot.val() === "PENDING" || snapshot.val() === "CLOSED") {
      status.html(msg)
      //btn.hide()
      return false;
    }
    status.html("AVAILABLE");
    btn.show()
  });

  $("#testForm").submit((e)=>{
      e.preventDefault();
      var selectedVal = $("input[name='test']:checked").val();
      alert(selectedVal);
      updateValue(selectedVal);
  })
  
  $("#book").click(() => {

    var currentStatus =  $("#currentStatus").text();
    var email = $("#email").val();

    if(email  === ""){
      alert('please insert email address')
      return false;
    }
    if( currentStatus == "PENDING" ||  currentStatus =="CLOSED" || currentStatus == "") {
      alert('NOT AVAILABLE');
      return false;
    }
    db.ref("test").update({ appointment: "PENDING", email:email });
    alert('BOOKED')
  })
  function updateValue(selectedVal) {
    db.ref("test").update({ appointment: selectedVal });
  }
 
</script>
</body>
</html>